<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">ğŸ“… Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h1>
            <button id="themeToggle" class="text-xl">
                <span id="themeIcon">ğŸŒ™</span>
            </button>
        </div>

        <div id="loading" class="text-center py-8">
            <p class="text-lg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª...</p>
        </div>

        <div id="errorMessage" class="hidden text-center py-8">
            <p class="text-red-500 font-semibold">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
        </div>

        <div id="matchesContainer" class="hidden space-y-10">
            <!-- Live Matches -->
            <section id="liveMatches" class="hidden">
                <h2 class="text-xl font-semibold mb-4">ğŸ¥ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© (<span id="liveCount">0</span>)</h2>
                <div id="liveMatchesList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </section>

            <!-- Upcoming Matches -->
            <section>
                <h2 class="text-xl font-semibold mb-4">â° Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (<span id="upcomingCount">0</span>)</h2>
                <div id="upcomingMatchesList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </section>

            <!-- Finished Matches -->
            <section id="finishedMatches" class="hidden">
                <h2 class="text-xl font-semibold mb-4">ğŸ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© (<span id="finishedCount">0</span>)</h2>
                <div id="finishedMatchesList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </section>
        </div>
    </div>

    <!-- Footer -->
    <footer
        class="bg-white dark:bg-gray-900 text-center py-4 text-gray-600 dark:text-gray-300 border-t dark:border-gray-700">
        <div class="max-w-6xl mx-auto text-center py-6 text-gray-600">
            Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©
            Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† ØªØ·ÙˆÙŠØ± <a class="text-blue-600" href="https://www.linkedin.com/in/jaber-zarif-3aa4b8114/"
                target="_blank">Ø¬Ø§Ø¨Ø± Ø²Ø±ÙŠÙ</a>
        </div>
    </footer>

    <!-- Modal for Live Stream -->
    <div id="playerModal" class="hidden fixed inset-0 bg-black/80 items-center justify-center z-50 p-4">
        <div class="relative w-full max-w-3xl bg-black rounded-lg overflow-hidden">
            <button id="closePlayer" class="absolute top-3 left-3 bg-red-600 text-white px-3 py-1 rounded">âœ–</button>
            <video id="liveVideo" controls autoplay class="w-full h-[400px]"></video>
        </div>
    </div>

    <script>
        const API_TOKEN = 'c3c0d056cc0b49a4945da165125df5d9'; // Replace with your token
        const API_URL = 'https://api.football-data.org/v4/matches';

        const streamMap = {}; // optional custom stream links

        const competitions = {
            'CL': { name: 'Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø£ÙˆØ±ÙˆØ¨Ø§', id: 2001 },
            'PL': { name: 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø§Ù„Ù…Ù…ØªØ§Ø²', id: 2021 },
            'PD': { name: 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠ', id: 2014 },
            'SA': { name: 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥ÙŠØ·Ø§Ù„ÙŠ', id: 2019 },
            'BL1': { name: 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠ', id: 2002 },
            'FL1': { name: 'Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ', id: 2015 }
        };

        let allMatches = [];

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('ar-TN', { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        function createMatchCard(match) {
            const home = match.homeTeam.name;
            const away = match.awayTeam.name;
            const homeCrest = match.homeTeam.crest;
            const awayCrest = match.awayTeam.crest;
            const league = match.competition.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const homeScore = match.score.fullTime.home ?? '-';
            const awayScore = match.score.fullTime.away ?? '-';
            const time = formatTime(match.utcDate);
            const status = match.status;

            let statusBadge = '';
            let statusText = '';

            if (['IN_PLAY', 'PAUSED'].includes(status)) {
                statusBadge = 'bg-red-600 text-white animate-pulse';
                statusText = 'Ù…Ø¨Ø§Ø´Ø± ğŸ”´';
            } else if (status === 'FINISHED') {
                statusBadge = 'bg-gray-600 text-white';
                statusText = 'Ø§Ù†ØªÙ‡Øª';
            } else {
                statusBadge = 'bg-blue-600 text-white';
                statusText = time;
            }

            return `
        <div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition cursor-pointer"
             onclick="playStream('${match.id}')">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center flex-1 min-w-0">
              <img src="${homeCrest}" alt="${home}" class="w-10 h-10 ml-2 object-contain flex-shrink-0">
              <span class="font-semibold text-sm truncate">${home}</span>
            </div>
            <span class="text-2xl font-bold">${homeScore} - ${awayScore}</span>
            <div class="flex items-center flex-1 justify-end min-w-0">
              <span class="font-semibold text-sm truncate">${away}</span>
              <img src="${awayCrest}" alt="${away}" class="w-10 h-10 mr-2 object-contain flex-shrink-0">
            </div>
          </div>
          <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
            <p class="text-xs text-gray-500 dark:text-gray-400 truncate">${league}</p>
            <span class="${statusBadge} text-xs px-2 py-1 rounded">${statusText}</span>
          </div>
        </div>`;
        }

        async function loadMatches() {
            const loading = document.getElementById('loading');
            const container = document.getElementById('matchesContainer');
            const errorMsg = document.getElementById('errorMessage');

            try {
                loading.classList.remove('hidden');
                container.classList.add('hidden');
                errorMsg.classList.add('hidden');

                const response = await fetch(API_URL, {
                    headers: { 'X-Auth-Token': API_TOKEN }
                });

                const data = await response.json();

                if (!response.ok) throw new Error(data.message || 'API Error');
                allMatches = data.matches || [];

                displayMatches();
                loading.classList.add('hidden');
                container.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                errorMsg.querySelector('p').textContent = `Ø­Ø¯Ø« Ø®Ø·Ø£: ${err.message}`;
                errorMsg.classList.remove('hidden');
                loading.classList.add('hidden');
            }
        }

        function displayMatches() {
            const live = allMatches.filter(m => ['IN_PLAY', 'PAUSED'].includes(m.status));
            const upcoming = allMatches.filter(m => ['TIMED', 'SCHEDULED'].includes(m.status));
            const finished = allMatches.filter(m => m.status === 'FINISHED');

            document.getElementById('liveCount').textContent = live.length;
            document.getElementById('upcomingCount').textContent = upcoming.length;
            document.getElementById('finishedCount').textContent = finished.length;

            const liveList = document.getElementById('liveMatchesList');
            const upcomingList = document.getElementById('upcomingMatchesList');
            const finishedList = document.getElementById('finishedMatchesList');

            liveList.innerHTML = live.map(createMatchCard).join('') || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©</p>';
            upcomingList.innerHTML = upcoming.map(createMatchCard).join('') || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù‚Ø§Ø¯Ù…Ø©</p>';
            finishedList.innerHTML = finished.map(createMatchCard).join('') || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…Ù†ØªÙ‡ÙŠØ©</p>';

            document.getElementById('liveMatches').classList.toggle('hidden', live.length === 0);
            document.getElementById('finishedMatches').classList.toggle('hidden', finished.length === 0);
        }

        function playStream(matchId) {
            const url = streamMap[matchId];
            if (!url) return alert('Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø« ØºÙŠØ± Ù…ØªÙˆÙØ± Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©.');

            const video = document.getElementById('liveVideo');
            const modal = document.getElementById('playerModal');

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        document.getElementById('closePlayer').addEventListener('click', () => {
            const modal = document.getElementById('playerModal');
            const video = document.getElementById('liveVideo');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            video.pause();
            video.src = '';
        });

        // ğŸŒ™ Theme toggle
        const toggleBtn = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const root = document.documentElement;

        if (localStorage.getItem('theme') === 'dark' ||
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            root.classList.add('dark');
            themeIcon.textContent = 'â˜€ï¸';
        }

        toggleBtn.addEventListener('click', () => {
            root.classList.toggle('dark');
            const isDark = root.classList.contains('dark');
            themeIcon.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        loadMatches();
        setInterval(loadMatches, 2 * 60 * 1000); // refresh every 2 minutes
    </script>
</body>

</html>